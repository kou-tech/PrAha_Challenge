# 課題1
## A.

Expand and Contract パターンは、データベースの変更を安全に段階的に進めるためのプラクティスである。
このパターンでは、「expand（拡張）」と「contract（縮小）」という2つのフェーズに分けて作業を進める。

Expandフェーズでは、現在のデータベースに新しい機能や構造を追加する。この時点では既存のコードは新しい構造を利用しないため、後方互換性を維持できる。
例えばテーブルに新しい列を追加する場合、最初はその列を空の状態で追加し、アプリケーションからはまだ使用しない状態にする。
この段階で、新しい列へのデータ移行やテストを実施することが重要である。

Contractフェーズは、アプリケーションが新しい構造を完全に使用するようになった後に実施する。
古い構造を削除する際は、アプリケーションコードからの依存関係が完全に無くなっていることを確認してから行う。
この方法により、移行前の十分なテストが可能になり、問題が発生した場合も容易にロールバックできる。

具体例として、「usersテーブルでusername列をnickname列に置き換える」場合

- Expand フェーズ
    - nickname列を追加
    - バッチ処理でnickname列にデータを移行
    - 新しいアプリケーションコードをデプロイしてnickname列の使用を開始
- Contract フェーズ
    - username列が未使用であることを確認
    - username列を削除

## A.

本番環境でのマイグレーション失敗の主な原因は、開発環境と本番環境でのデータ量の違いにあると考える。

開発環境では通常、空のデータベースや少量のデータでテストを行うが、本番環境には大量の既存データが存在し、その中には`NULL`値が含まれている可能性がある。

このような`NULL`値の存在が、`NOT NULL`制約の追加時に失敗を引き起こす原因となる。
この問題を回避するために、以下の手順で分割マイグレーションを実施することが効果的である。

1. 該当カラムにデフォルト値を設定する。
2. 次に、既存の`NULL`データを適切な値で更新する。
3. 最後に、`NOT NULL`制約を追加する。

# 課題2
[作業手順書はこちら](./作業手順書.md)
